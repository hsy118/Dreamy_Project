<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.Dreamy.model.mapper.BoardMapper">
	
	<insert id="insertBucket" parameterType="Map">
		insert into Board (uid, board_type, title, content, start_date, end_date, category, image_url)
		values (#{uid}, #{boardType}, #{title}, #{content}, current_date(), #{endDate}, #{category}, #{imageUrl})
	</insert>
	
	<insert id="insertChallenge" parameterType="Map">
		insert into Board (uid, board_type, title, content, start_date, end_date, category, image_url, total_date)
		values (#{uid}, #{boardType}, #{title}, #{content}, #{startDate}, #{endDate}, #{category}, #{imageUrl}, #{totalDate})
	</insert>
	
	<select id="getList" parameterType="Map" resultType="com.ssafy.Dreamy.model.BoardDto">
		select distinct pid, uid, name, board_type as boardType, title, content, written_date as writtenDate,
		start_date as startDate, end_date as endDate, category, image_url as imageUrl, total_date as totalDate
		from User, Board, Follow
		where Board.uid = #{uid} or Board.uid IN (select follower from Follow where following = #{uid})
		order by written_date DESC
		limit #{limit}, 3
	</select>
	
	<select id="getBucketList" parameterType="Map" resultType="com.ssafy.Dreamy.model.BoardDto">
		select pid, uid, name, board_type as boardType, title, content, written_date as writtenDate,
		start_date as startDate, end_date as endDate, category, image_url as imageUrl, total_date as totalDate from User, Board
		where User.uid = Board.uid and board_type = 1
		order by written_date DESC
		limit #{limit}, 3
	</select>
	
	<select id="getChallengeList" parameterType="Map" resultType="com.ssafy.Dreamy.model.BoardDto">
		select pid, uid, name, board_type as boardType, title, content, written_date as writtenDate,
		start_date as startDate, end_date as endDate, category, image_url as imageUrl, total_date as totalDate from User, Board
		where User.uid = Board.uid and board_type = 2
		order by written_date DESC
		limit #{limit}, 3
	</select>
	
	<select id="getListTotalSize" resultType="int">
		SELECT count(distinct pid) FROM User, Board, Follow
		where Board.uid = #{uid} or Board.uid IN (select follower from Follow where following = #{uid})
	</select>
	
	<select id="getBucketOrChallengeTotalSize" resultType="int">
		SELECT count(*) FROM Board
		where board_type = #{boardType}
	</select>
	
	<update id="update" parameterType="Map">
		update Board
		set content=#{content}
		where pid=#{pid}
	</update>
	
</mapper>
